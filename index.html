<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tam ThÃ¡i Tá»­</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="stylesen1.css">
</head>
<body>
  <div id="greetingPopup" class="fullscreen-overlay" role="dialog" aria-modal="true" aria-labelledby="greetingTitle">
    <div class="box">
      <h2 id="greetingTitle" style="margin:0">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ThÃ¡p HÃ  Ná»™i!</h2>
      <div style="color:var(--muted);margin-top:8px">Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t, báº¡n cÃ³ muá»‘n báº­t nháº¡c ná»n khÃ´ng?</div>
      <div style="margin-top:12px; display:flex; justify-content:center; gap: 12px;">
        <button id="musicYes" class="btn">CÃ³, báº­t nháº¡c</button>
        <button id="musicNo" class="ghost">KhÃ´ng, cáº£m Æ¡n</button>
      </div>
    </div>
  </div>

  <div id="modeSelect" class="fullscreen-overlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modeTitle">
    <div class="box">
      <h2 id="modeTitle" style="margin:0">Chá»n cháº¿ Ä‘á»™</h2>
      <div style="color:var(--muted);margin-top:8px">Báº¯t Ä‘áº§u báº±ng cÃ¡ch chá»n má»™t cháº¿ Ä‘á»™. Báº¡n cÃ³ thá»ƒ Ä‘á»•i láº¡i sau.</div>
      <div class="mode-grid" role="list">
        <button class="mode-card" id="mode-play" role="listitem"><h3>ğŸ® Play</h3><p>ChÆ¡i tá»± do: kÃ©o tháº£, tÃ­nh giá», lÆ°u ká»· lá»¥c.</p></button>
        <button class="mode-card" id="mode-teach" role="listitem"><h3>ğŸ“ Teach</h3><p>Há»c cÃ¡ch giáº£i. Game sáº½ gá»£i Ã½ vÃ  chá» báº¡n Ä‘i Ä‘Ãºng.</p></button>
        <button class="mode-card" id="mode-learn" role="listitem"><h3>ğŸ§  Learn (Äá»‡ quy)</h3><p>Trá»±c quan hÃ³a thuáº­t toÃ¡n, call stack & tá»«ng bÆ°á»›c.</p></button>
        <button class="mode-card" id="mode-challenge" role="listitem"><h3>â±ï¸ Challenge</h3><p>HoÃ n thÃ nh trong thá»i háº¡n. 3 cáº¥p Ä‘á»™ Dá»…/Vá»«a/KhÃ³.</p></button>
        <button class="mode-card" id="mode-sandbox" role="listitem"><h3>ğŸš€ Sandbox</h3><p>TÃ¹y chá»‰nh sá»‘ cá»™t vÃ  luáº­t chÆ¡i cá»§a riÃªng báº¡n.</p></button>
      </div>
      <div style="margin-top:12px;display:flex;justify-content:center"><button id="modeStart" class="btn">XÃ¡c nháº­n</button></div>
    </div>
  </div>
  
  <div id="sandboxSetupPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="sandboxTitle">
        <div class="popup-box wide sandbox-lab">
            <h3 id="sandboxTitle" style="margin-top:0">ğŸš€ Sandbox Custom Lab</h3>
            <p style="color:var(--muted);margin:4px 0 16px;">Thiáº¿t káº¿ mÃ n chÆ¡i ThÃ¡p HÃ  Ná»™i cá»§a riÃªng báº¡n.</p>
            
            <div class="lab-section">
                <h4>Cáº¥u hÃ¬nh CÆ¡ báº£n</h4>
                <div class="lab-controls-grid">
                    <div class="lab-control">
                        <label for="sandboxDisks">Sá»‘ Ä‘Ä©a: <span id="sandboxDisksValue">4</span></label>
                        <input type="range" id="sandboxDisks" min="2" max="8" value="4">
                    </div>
                    <div class="lab-control">
                        <label for="sandboxPoles">Sá»‘ cá»™t: <span id="sandboxPolesValue">4</span></label>
                        <input type="range" id="sandboxPoles" min="3" max="6" value="4">
                    </div>
                </div>
            </div>
            
            <div class="lab-section">
                <h4>Luáº­t chÆ¡i & Má»¥c tiÃªu</h4>
                <div class="lab-controls-grid">
                    <div class="lab-control">
                         <label for="sandboxRule">Quy táº¯c di chuyá»ƒn:</label>
                         <select id="sandboxRule">
                            <option value="classic">Cá»• Ä‘iá»ƒn (KhÃ´ng giá»›i háº¡n)</option>
                            <option value="cyclic">Tuáº§n hoÃ n (Má»™t chiá»u)</option>
                            <option value="adjacent">Liá»n ká» (Hai chiá»u)</option>
                        </select>
                        <p id="sandboxRuleDesc" class="rule-desc">Di chuyá»ƒn Ä‘Ä©a tá»± do, miá»…n lÃ  Ä‘Ä©a nhá» hÆ¡n á»Ÿ trÃªn.</p>
                    </div>
                    <div class="lab-control">
                         <label for="sandboxStartPos">Vá»‹ trÃ­ ban Ä‘áº§u:</label>
                         <select id="sandboxStartPos">
                            <option value="classic">Cá»• Ä‘iá»ƒn (Táº¥t cáº£ á»Ÿ Cá»™t 1)</option>
                            <option value="spread">Tráº£i Ä‘á»u (1 Ä‘Ä©a/cá»™t)</option>
                            <option value="last_pole">Äáº£o ngÆ°á»£c (Táº¥t cáº£ á»Ÿ Cá»™t cuá»‘i)</option>
                        </select>
                        <p class="rule-desc">ÄÄ©a sáº½ Ä‘Æ°á»£c sáº¯p xáº¿p ban Ä‘áº§u nhÆ° tháº¿ nÃ o.</p>
                    </div>
                    <div class="lab-control">
                         <label for="sandboxTarget">Má»¥c tiÃªu chiáº¿n tháº¯ng:</label>
                         <select id="sandboxTarget">
                            <option value="any_other">HoÃ n thÃ nh á»Ÿ báº¥t ká»³ cá»™t nÃ o (trá»« cá»™t 1)</option>
                            <option value="last_pole">Chá»‰ hoÃ n thÃ nh á»Ÿ cá»™t cuá»‘i cÃ¹ng</option>
                        </select>
                        <p class="rule-desc">Äiá»u kiá»‡n Ä‘á»ƒ tÃ­nh lÃ  chiáº¿n tháº¯ng.</p>
                    </div>
                </div>
            </div>

            <div class="popup-actions">
                <button id="sandboxStart" class="btn">Báº¯t Ä‘áº§u ThÃ­ nghiá»‡m</button>
            </div>
        </div>
    </div>


  <div class="app" id="app">
    <div class="header">
      <h1>ThÃ¡p HÃ  Ná»™i</h1>
      <div id="titleDisplayContainer" class="title-container">
        <span id="titleDisplay" class="title-badge" title="Click Ä‘á»ƒ xem vÃ  Ä‘á»•i danh hiá»‡u">TÃ¢n Binh</span>
      </div>
      <div class="kv" style="margin-left: 12px; font-weight: 600;">Mode: <span id="currentModeDisplay" style="color: var(--accent);">Play</span></div>
      <div class="topmeta">
        <div class="badge">Moves: <span id="mv" aria-live="polite">0</span></div>
        <div id="best-score-display" class="badge">Best (<span id="best-n">4</span> Ä‘Ä©a): <span id="best">â€”</span></div>
        <div id="sandbox-status" class="badge" style="display: none;">Sandbox Mode</div>
        <div class="badge">Time: <span id="tm" aria-live="polite">00:00</span></div>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <label>Sá»‘ Ä‘Ä©a: <input id="n" type="number" min="1" max="8" value="4"></label>
        <label>Theme:
          <select id="theme" class="theme-select">
            <option value="classic">âœ¨ Classic</option><option value="burger">ğŸ” Burger</option><option value="rescue">ğŸ± MÃ¨o</option><option value="neon">ğŸŒˆ Neon</option><option value="dark">ğŸŒ™ Dark Cozy</option>
          </select>
        </label>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
             <label class="kv">Ã‚m: <input id="snd" type="checkbox" checked></label>
             <button id="settingsBtn" class="ghost" style="padding: 6px 10px; line-height: 1;" title="CÃ i Ä‘áº·t Ã‚m thanh">ğŸµ</button>
        </div>
      </div>

      <div class="row" style="align-items:center">
        <label id="speedLabel" style="display: none;">Tá»‘c Ä‘á»™ (Auto/Learn):
          <select id="spd" class="speed-select"><option value="1200">Cháº­m</option><option value="700" selected>Vá»«a</option><option value="300">Nhanh</option></select>
        </label>
        <button class="btn" id="reset">Reset</button>
        <button class="ghost" id="changeMode">Äá»•i Cháº¿ Ä‘á»™</button>
        <button class="ghost" id="undo" disabled>Undo</button>
        <button class="ghost" id="auto">Auto-solve</button>
        <button class="ghost" id="hint">Gá»£i Ã½</button>
        <div style="margin-left:auto;display:flex;gap:12px;align-items:center">
          <div class="progress" title="Tiáº¿n Ä‘á»™"><i id="prog"></i></div>
          <div class="hud"><div class="kv">HÆ°á»›ng dáº«n: <span id="hintText" aria-live="polite">â€”</span></div></div>
        </div>
      </div>
    </div>

    <div class="wrap-stage" id="stage">
      </div>
    <div class="footerNote">Máº¹o: KÃ©o tháº£ hoáº·c dÃ¹ng phÃ­m sá»‘ (1, 2, 3...) Ä‘á»ƒ chá»n cá»c vÃ  di chuyá»ƒn Ä‘Ä©a. Nháº¥n 'Esc' Ä‘á»ƒ há»§y.</div>
  </div>

  <div id="finish" class="finishPop"></div>
  
  <div id="errorPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="errorTitle">
    <div class="popup-box error-box">
      <div id="errorTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">âš ï¸ Di chuyá»ƒn khÃ´ng há»£p lá»‡!</div>
      <p id="errorPopupText" style="color:var(--muted);margin:0">KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t Ä‘Ä©a lá»›n lÃªn trÃªn Ä‘Ä©a nhá» hÆ¡n.</p>
      <div class="popup-actions"><button id="errorConfirm" class="btn">Hiá»ƒu rá»“i</button></div>
    </div>
  </div>

  <div id="hintPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="hintTitle">
    <div class="popup-box">
      <h3 id="hintTitle" style="margin-top:0">ğŸ’¡ Gá»£i Ã½ cho báº¡n</h3>
      <p id="hintTextPopup" style="margin:4px 0;line-height:1.5;"></p>
      <div class="popup-actions"><button id="hintClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  
  <div id="challengeDifficultyPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeTitle">
      <div class="popup-box">
          <h3 id="challengeTitle" style="margin-top:0">Chá»n Ä‘á»™ khÃ³ Challenge</h3>
          <p style="color:var(--muted);margin:4px 0 12px;">Thá»i gian sáº½ Ä‘Æ°á»£c tÃ­nh dá»±a trÃªn sá»‘ Ä‘Ä©a.</p>
          <div class="popup-actions" style="flex-direction:column;">
              <button id="difficultyEasy" class="btn">ğŸ˜„ Dá»…</button>
              <button id="difficultyMedium" class="btn" style="background-color:#f39c12;">ğŸ˜ Vá»«a</button>
              <button id="difficultyHard" class="btn" style="background-color:#e74c3c;">ğŸ¥µ KhÃ³</button>
          </div>
      </div>
  </div>

  <div id="achievementsPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="achieveTitle">
        <div class="popup-box wide">
            <h3 id="achieveTitle" style="margin-top:0">ğŸ† ThÃ nh tÃ­ch & Danh hiá»‡u</h3>
            <p style="color:var(--muted);margin:4px 0 12px;">Má»Ÿ khÃ³a thÃ nh tÃ­ch Ä‘á»ƒ nháº­n danh hiá»‡u má»›i. Click vÃ o danh hiá»‡u Ä‘Ã£ má»Ÿ khÃ³a Ä‘á»ƒ trang bá»‹.</p>
            <div id="achievementsList" class="achievements-list">
                </div>
            <div class="popup-actions"><button id="achievementsClose" class="btn">ÄÃ³ng</button></div>
        </div>
    </div>
    
  <div id="achievementUnlockedPopup" class="finishPop" style="min-width:320px;display:flex;align-items:center;justify-content:center;flex-direction:column;"></div>

  <div id="loserPopup" class="popup" style="display:none" role="alert"><div class="popup-box"><div style="font-weight:900;font-size:20px;color:#d23"></div><div style="margin-top:12px"><button id="loserClose" class="btn">ÄÃ³ng</button></div></div></div>

  <div id="settingsPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="popup-box wide">
          <h3 id="settingsTitle" style="margin-top:0">ğŸµ CÃ i Ä‘áº·t Ã‚m thanh TÃ¹y chá»‰nh</h3>
          <p style="color:var(--muted);margin:4px 0 16px;">Táº£i lÃªn tá»‡p Ã¢m thanh (.mp3, .wav) cá»§a riÃªng báº¡n. CÃ¡c thay Ä‘á»•i sáº½ Ä‘Æ°á»£c lÆ°u vÃ o bá»™ nhá»› trÃ¬nh duyá»‡t.</p>
          <div class="settings-grid">
              <div class="setting-item">
                  <label for="bgmUpload">Nháº¡c ná»n (BGM):</label>
                  <input type="file" id="bgmUpload" accept="audio/*" class="audio-upload">
                  <span id="bgmUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
              <div class="setting-item">
                  <label for="pickupUpload">Ã‚m thanh Nháº¥c Ä‘Ä©a:</label>
                  <input type="file" id="pickupUpload" accept="audio/*" class="audio-upload">
                  <span id="pickupUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
               <div class="setting-item">
                  <label for="dropUpload">Ã‚m thanh Äáº·t Ä‘Ä©a:</label>
                  <input type="file" id="dropUpload" accept="audio/*" class="audio-upload">
                  <span id="dropUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
               <div class="setting-item">
                  <label for="winUpload">Ã‚m thanh Chiáº¿n tháº¯ng:</label>
                  <input type="file" id="winUpload" accept="audio/*" class="audio-upload">
                  <span id="winUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
          </div>
          <div class="popup-actions" style="margin-top:20px; justify-content: space-between;">
              <button id="settingsReset" class="ghost" style="border-color:#e74c3c; color:#e74c3c;">KhÃ´i phá»¥c Máº·c Ä‘á»‹nh</button>
              <button id="settingsClose" class="btn">ÄÃ³ng</button>
          </div>
      </div>
  </div>


  <audio id="bgm" loop preload="auto" data-default-src="smooth-gaming-atmosphere-323659.mp3">
    <source src="smooth-gaming-atmosphere-323659.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="snd_pickup" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2021/09/07/audio_7b76a6e4b7.mp3?filename=pop.mp3">
    <source src="pop-402324.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_drop" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c5ec65b3b2.mp3?filename=click.mp3">
    <source src="beep-329314.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_error" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6c04b5a7ff.mp3?filename=error.mp3">
    <source src="error-126627.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_win" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_ebf02b5f33.mp3?filename=applause.mp3">
    <source src="votay.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_fireworks" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2bb1d8a7a3.mp3?filename=fireworks.mp3">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2bb1d8a7a3.mp3?filename=fireworks.mp3" type="audio/mpeg">
  </audio>

  <div id="learnPanel" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Learn Trace (Äá»‡ quy)</div>
      <div style="font-size:13px;color:var(--muted)">n = <span id="learnN">4</span></div>
    </div>
    
    <div id="pseudoCodeArea">
        <div class="code-line" data-line="0"><b>Hanoi</b>(k, from, to, aux):</div>
        <div class="code-line" data-line="1" style="padding-left: 1em;">IF k > 0 THEN</div>
        <div class="code-line" data-line="2" style="padding-left: 2em;">Hanoi(k-1, from, aux, to)</div>
        <div class="code-line" data-line="3" style="padding-left: 2em;">Move disk k from <b>from</b> to <b>to</b></div>
        <div class="code-line" data-line="4" style="padding-left: 2em;">Hanoi(k-1, aux, to, from)</div>
        <div class="code-line" data-line="5" style="padding-left: 1em;">END IF</div>
    </div>
    
    <div id="stackArea"></div>
    <div id="learnExplain"></div>
    <div style="display:flex;gap:8px;margin-top:10px;justify-content:center">
      <button id="learnPrev" class="ghost">Prev</button>
      <button id="learnPlay" class="btn">Play</button>
      <button id="learnPause" class="ghost" style="display:none">Pause</button>
      <button id="learnNext" class="ghost">Next</button>
    </div>
    <div style="display:flex;justify-content:center;margin-top:8px">
      <label style="font-size:13px;color:var(--muted)">Speed:
        <select id="learnSpeed" class="speed-select"><option value="1200">Slow</option><option value="700" selected>Medium</option><option value="300">Fast</option></select>
      </label>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>
<script src="ap1.js" defer></script>
</body>
</html>
